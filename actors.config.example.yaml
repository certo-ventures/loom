# Actor Configuration Example
# Production-ready actor metadata with all fields

version: "1.0"

actors:
  # Example 1: Document Processing Actor (Full Metadata)
  - name: "PDF Extractor"
    description: "Extracts text, images, and metadata from PDF documents with OCR support"
    type: javascript
    reference: "./actors/pdf-extractor.js"
    version: "2.1.0"
    author: "Jane Smith"
    owner: "Document Processing Team"
    
    # Security & Governance
    policies:
      authentication: jwt
      authorization:
        roles: ["document-processor", "admin"]
        scopes: ["documents:read", "documents:write"]
      rateLimit:
        requestsPerMinute: 60
        requestsPerHour: 1000
        burstSize: 10
      dataClassification: confidential
      piiHandling: true
      dataRetention: "90d"
      egressAllowed: false
    
    permissions:
      system:
        - "fs:read"
        - "network:http"
      storage:
        - type: s3
          operations: ["read"]
        - type: redis
          operations: ["read", "write"]
    
    # AI Context
    aiContext:
      purpose: "Extract structured data from PDF documents including text, tables, images, and metadata"
      usageGuidelines: |
        Use this actor when you need to:
        - Extract text from scanned PDFs (OCR enabled)
        - Parse structured data from forms
        - Extract tables and convert to JSON
        - Get document metadata (author, creation date, etc.)
        
        Not suitable for:
        - Password-protected PDFs
        - Corrupted files
        - Documents larger than 100MB
      
      capabilities:
        - name: extractText
          description: "Extract all text content from PDF"
          parameters:
            type: object
            properties:
              includePageNumbers:
                type: boolean
              ocrLanguage:
                type: string
                enum: ["eng", "fra", "deu", "spa"]
          returns:
            type: object
            properties:
              text:
                type: string
              pageCount:
                type: number
        
        - name: extractTables
          description: "Extract tables as structured JSON"
          returns:
            type: array
            items:
              type: object
      
      examples:
        - scenario: "Extract text from invoice"
          input:
            documentUrl: "s3://documents/invoice-2024.pdf"
            extractText: true
            ocrLanguage: "eng"
          expectedOutput:
            text: "Invoice #12345..."
            pageCount: 3
          explanation: "Extracts invoice text with OCR for scanned documents"
      
      limitations:
        - "Maximum file size: 100MB"
        - "OCR languages: English, French, German, Spanish only"
        - "Password-protected PDFs not supported"
      
      bestPractices:
        - "Pre-check file size before processing"
        - "Use appropriate OCR language for best results"
        - "Consider chunking large documents"
      
      relatedActors:
        - "invoice-parser"
        - "document-classifier"
      
      estimatedCost:
        unit: api-calls
        approximate: 1
    
    # Data Contracts
    inputSchema:
      type: object
      required: ["documentUrl"]
      properties:
        documentUrl:
          type: string
          description: "S3 URL or file path to PDF document"
        extractText:
          type: boolean
          default: true
        extractImages:
          type: boolean
          default: false
        extractTables:
          type: boolean
          default: false
        ocrLanguage:
          type: string
          enum: ["eng", "fra", "deu", "spa"]
          default: "eng"
    
    outputSchema:
      type: object
      properties:
        success:
          type: boolean
        text:
          type: string
        images:
          type: array
          items:
            type: object
            properties:
              pageNumber:
                type: number
              data:
                type: string
                description: "Base64 encoded image"
        tables:
          type: array
          items:
            type: object
        metadata:
          type: object
          properties:
            author:
              type: string
            createdDate:
              type: string
            pageCount:
              type: number
    
    # Discovery & Organization
    tags:
      - document-processing
      - pdf
      - ocr
      - extraction
    
    category: data-processing
    
    # Dependencies
    dependencies:
      - type: package
        name: pdf-parse
        version: "^1.1.1"
        required: true
      - type: package
        name: tesseract.js
        version: "^4.0.0"
        required: true
        purpose: "OCR engine"
      - type: service
        name: s3-storage
        optional: false
    
    # Configuration
    configuration:
      environmentVariables:
        - name: AWS_REGION
          description: "AWS region for S3 access"
          required: true
          default: "us-east-1"
        
        - name: TESSERACT_LANG_PATH
          description: "Path to Tesseract language data"
          required: false
          default: "./tessdata"
        
        - name: MAX_FILE_SIZE_MB
          description: "Maximum PDF file size in MB"
          required: false
          default: "100"
          validation: "^[0-9]+$"
      
      runtime:
        memoryLimit: "2GB"
        timeout: 120000
        concurrency: 5
    
    # Performance
    performance:
      latency:
        p50: 2000
        p95: 8000
        p99: 15000
        unit: ms
      
      throughput:
        requestsPerSecond: 10
        maxConcurrency: 5
      
      resources:
        cpu: "2 cores"
        memory: "2GB"
        storage: "1GB"
    
    # Deployment
    deployment:
      targets:
        - cloud
        - local
      
      requirements:
        nodeVersion: ">=18.0.0"
        platform:
          - linux
          - macos
      
      healthCheck:
        endpoint: "/health"
        interval: 30
        timeout: 5000
        unhealthyThreshold: 3
      
      scaling:
        min: 2
        max: 10
        metric: queue-depth
        target: 5
    
    # Documentation
    documentation:
      readme: "https://docs.example.com/actors/pdf-extractor"
      apiDocs: "https://api-docs.example.com/pdf-extractor"
      examples: "https://github.com/example/loom-actors/tree/main/examples/pdf"
      troubleshooting: "https://docs.example.com/troubleshooting/pdf-extractor"
      external:
        - title: "PDF Processing Best Practices"
          url: "https://example.com/pdf-best-practices"
    
    # Lifecycle
    lifecycle:
      stage: stable
      createdAt: "2024-01-15T10:00:00Z"
      updatedAt: "2024-12-20T15:30:00Z"
      changelog: "https://github.com/example/loom-actors/blob/main/CHANGELOG.md#210"
    
    # Observability
    observability:
      metrics:
        - name: pdf_pages_processed
          type: counter
          description: "Total number of PDF pages processed"
          labels: ["status"]
        
        - name: pdf_processing_duration
          type: histogram
          description: "PDF processing duration in milliseconds"
          labels: ["file_size_category"]
      
      tracing:
        enabled: true
        samplingRate: 0.1
        propagationFormat: w3c
      
      logging:
        level: info
        structuredLogging: true
        piiRedaction: true

  # Example 2: WASM Actor (Minimal Metadata)
  - name: "Image Resizer"
    description: "High-performance image resizing using WebAssembly"
    type: wasm
    reference: "./wasm/image-resizer.wasm"
    version: "1.0.0"
    author: "WASM Team"
    
    tags:
      - image-processing
      - wasm
    
    category: transformation
    
    inputSchema:
      type: object
      required: ["imageData", "width", "height"]
      properties:
        imageData:
          type: string
          description: "Base64 encoded image"
        width:
          type: number
        height:
          type: number
        quality:
          type: number
          minimum: 1
          maximum: 100
          default: 85
    
    outputSchema:
      type: object
      properties:
        resizedImage:
          type: string
          description: "Base64 encoded resized image"
        originalSize:
          type: number
        newSize:
          type: number
    
    lifecycle:
      stage: stable

  # Example 3: AI Agent Actor with Environment Variables
  - name: "Customer Support Agent"
    description: "AI-powered customer support with LLM integration"
    type: javascript
    reference: "./actors/customer-support-agent.js"
    version: "1.2.0"
    author: "AI Team"
    owner: "Customer Success"
    
    policies:
      authentication: jwt
      authorization:
        roles: ["support-agent", "admin"]
      rateLimit:
        requestsPerMinute: 30
      dataClassification: confidential
      piiHandling: true
    
    permissions:
      apis:
        - service: openai
          scopes: ["chat:completions"]
        - service: zendesk
          scopes: ["tickets:read", "tickets:write"]
    
    aiContext:
      purpose: "Handle customer support inquiries using GPT-4 with access to knowledge base"
      usageGuidelines: |
        Use for:
        - General product questions
        - Technical support (Tier 1)
        - Account inquiries
        
        Escalate for:
        - Billing disputes
        - Legal questions
        - Complex technical issues
      
      capabilities:
        - name: answerQuestion
          description: "Answer customer question using knowledge base and LLM"
        
        - name: createTicket
          description: "Create support ticket in Zendesk"
        
        - name: escalateToHuman
          description: "Escalate conversation to human agent"
      
      limitations:
        - "Cannot handle billing disputes"
        - "Limited to English language"
        - "Requires internet connectivity"
      
      estimatedCost:
        unit: tokens
        approximate: 500
    
    configuration:
      environmentVariables:
        - name: OPENAI_API_KEY
          description: "OpenAI API key for GPT-4"
          required: true
          secret: true
        
        - name: OPENAI_MODEL
          description: "OpenAI model to use"
          required: false
          default: "gpt-4-turbo"
        
        - name: ZENDESK_TOKEN
          description: "Zendesk API token"
          required: true
          secret: true
        
        - name: KNOWLEDGE_BASE_URL
          description: "URL to knowledge base API"
          required: true
          default: "${KB_SERVICE_URL:-http://kb-service:3000}"
    
    tags:
      - ai-agent
      - customer-support
      - llm
    
    category: ai-agent
    
    lifecycle:
      stage: beta
      createdAt: "2024-11-01T09:00:00Z"
      updatedAt: "2024-12-15T12:00:00Z"
